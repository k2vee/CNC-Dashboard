{% extends 'base.html' %}
{% block body %}
    <!-- To resolve: dependency on 'toggleMotorSelection'-->
    <div id="cycleCountsSection">
    <div id="motorSelectionButtons">
        <button id="buttonX" class="motor-button selected-button" onclick="toggleMotorSelection('X')">Motor
            X</button>
        <button id="buttonY" class="motor-button selected-button" onclick="toggleMotorSelection('Y')">Motor
            Y</button>
        <button id="buttonZ" class="motor-button selected-button" onclick="toggleMotorSelection('Z')">Motor
            Z</button>
        <button id="buttonSpindle" class="motor-button selected-button"
            onclick="toggleMotorSelection('Spindle')">Spindle</button>
    </div>
    <div id="cycleCountsValues">
        <h2>Cycle Counts</h2>
        <div id="cycleCountsX" class="current-panel">
            <h3>Cycle Count X</h3>
            <p class="cycle-count-valuex">0</p>
        </div>
        <div id="cycleCountsY" class="current-panel">
            <h3>Cycle Count Y</h3>
            <p class="cycle-count-valuey">0</p>
        </div>
        <div id="cycleCountsZ" class="current-panel">
            <h3>Cycle Count Z</h3>
            <p class="cycle-count-valuez">0</p>
        </div>
        <div id="cycleCountsSpindle" class="current-panel">
            <h3>Cycle Count Spindle</h3>
            <p class="cycle-count-valuespindle">0</p>
        </div>
    </div>
    <div id="cycleCountsGraphs" class="graph-container">
        <div class="chart-wrapper">
            <canvas id="cycleCountsChart" width="40%" height="40%"></canvas>
        </div>
        <div class="chart-wrapper">
            <canvas id="cycleCountsSpindleChart" width="40%" height="40%"></canvas>
        </div>
    </div>
    </div>
{% endblock %}
{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function()    {
            /*
            // Ideally, the data is already filtered server-side so the entire database isnt passed to client,
            // then the client has to filter it.
            fetchGroupData('cycleCountCurrents');
            */
            filterUpdateCharts('{{data}}');
        })
        // Function to update the 'CYCCNT' line chart
        function filterUpdateCharts(data) {
            const cyccntLabels = Array.from({ length: data.length }, (_, i) => i + 1); // Sequential x-axis values
            const cyccntData = data.filter(row => [2, 3, 4].includes(row.NodeKey));
            const cyccntDatasets = createDatasets(cyccntData, ['X', 'Y', 'Z'], ['#FFC3A0', '#A0FFC3', '#A0C3FF']);
            // Create line chart with datasets for 'CYCCNT'
            createLineChart(cyccntChartId, cyccntLabels, cyccntDatasets, 'CYCCNT');

            const cycleCountlabels = Array.from({ length: data.length }, (_, i) => i + 1); // Sequential x-axis values
            const cycleCountData = data.filter(row => [43].includes(row.NodeKey));
            const cycleCountDatasets = createDatasets(cycleCountData, ['Spindle'], ['#FF8C66']);
            // Create line chart with datasets for 'CycleCount'
            createLineChart(cycleCountChartId, cycleCountlabels, cycleCountDatasets, 'CycleCount');
        }
    </script>
{% endblock%}