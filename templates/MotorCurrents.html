{% extends 'base.html' %}
{% block content %}
    <div id="motorSelectionButtons">
        <button id="buttonX" class="motor-button selected-button" onclick="aeiou('X')">
            Motor X</button>
        <button id="buttonY" class="motor-button selected-button" onclick="aeiou('Y')">
            Motor Y</button>
        <button id="buttonZ" class="motor-button selected-button" onclick="aeiou('Z')">
            Motor Z</button>
        <button id="buttonSpindle" class="motor-button selected-button" onclick="aeiou('Spindle')">
            Spindle</button>
    </div>
    <div id="latestValues">
        <div class="chart-latestValues">
            <p class="valueTitle">Current</p>
            <p class="motorId">Motor X</p>
            <p id="latest-X">0</p>
            <p class="motorId">Motor Y</p>
            <p id="latest-Y">0</p>
            <p class="motorId">Motor Z</p>
            <p id="latest-Z">0</p>
        </div>
        <div class="chart-latestValues">
            <p class="valueTitle">Maximum Currents</p>
            <p class="motorId">Motor X</p>
            <p id="latest-X">0</p>
            <p class="motorId">Motor Y</p>
            <p id="latest-Y">0</p>
            <p class="motorId">Motor Z</p>
            <p id="latest-Z">0</p>
        </div>
    </div>
    <div id="currentGraphs" class="graph-container">
        <div class="chart-wrapper">
            <canvas id="currentChart"></canvas>
        </div>
        <div class="chart-wrapper">
            <canvas id="maxCurChart"></canvas>
        </div>
    </div>
    <button style="background-color: aqua;" onclick="addLineChartData(currentChartId, 'Motor X', await fetchDataSingular('Current1'))"> update button </button>
    <button style="background-color:darkviolet;" onclick="removeLineChartData(currentChartId)"> remove button </button>
{% endblock %}
{% block script %}
    <script>
        // Global vars/accessible data objects
        var CurrentData, MAXCURData;
        const currentChartId = 'currentChart';
        const maxCurChartId = 'maxCurChart';

        document.addEventListener('DOMContentLoaded', async function ()   {
            /*
            // Ideally, the data is already filtered server-side so the entire database isnt passed to client,
            // then the client has to filter it.
            */
            CurrentData = await fetchDataGroupLimited('Current', 100);
            CurrentData.reverse();
            filterUpdateCurrentChart(CurrentData);

            MAXCURData = await fetchDataGroupLimited('MAXCUR', 100);
            MAXCURData.reverse();
            filterUpdateMaxcurChart(MAXCURData);

            updateCurrentValues(CurrentData);
        });

        // Function to update the 'Current' and 'MAXCUR' line chart
        function filterUpdateCurrentChart(data) {
            const currentLabels = Array.from({ length: data.length }, (_, i) => i + 1); // Sequential x-axis values
            CurrentData = data.filter(row => ['Current1', 'Current2', 'Current3'].some(v => row.NodeId.includes(v)));
            const currentDatasets = createDatasets(CurrentData, ['X', 'Y', 'Z']);
            // Create line chart with datasets for 'Current'
            createLineChart(currentChartId, currentLabels, currentDatasets, 'Current');
        }

        function filterUpdateMaxcurChart(data)   {
            const maxCurlabels = Array.from({ length: data.length }, (_, i) => i + 1); // Sequential x-axis values
            MAXCURData = data.filter(row => ['MAXCUR21', 'MAXCUR22', 'MAXCUR23'].some(v => row.NodeId.includes(v)));
            const maxCurDatasets = createDatasets(MAXCURData, ['X', 'Y', 'Z']);
            // Create line chart with datasets for 'MAXCUR'
            createLineChart(maxCurChartId, maxCurlabels, maxCurDatasets, 'MAXCUR');
        }

        function aeiou(motor)  {
            /*
            if (motor == 'Spindle')
                toggleMotorSelection(motor, CurrentData);
            else
                toggleMotorSelection(motor, MAXCURData);
            */
            const button = document.getElementById(`button${motor}`);
            button.classList.toggle("selected-button");

            toggleMotorSelection(currentChartId, CurrentData, 'Current');
            toggleMotorSelection(maxCurChartId, MAXCURData, 'MAXCUR');
        }

    </script>
{% endblock%}